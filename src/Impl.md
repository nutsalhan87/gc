# Реестр

Исходный код располагается в [registry](./registry).

## Основные эндпоинты

- **GET** */registry/collectors*. Получить список зарегистрированных хранилищ.

- **PUT** */registry/collectors*. Зарегистрировать хранилище.

- **DELETE** */registry/collectors*. Удалить хранилище из реестра.

## Детали реализации

Подразумевается, что время жизни реестра намного больше времени жизни хранилищ. 
Поэтому информация о них хранится в оперативной памяти, а не на диске средставми БД, т.к. это было бы излишне.

# Хранилище

Исходный код располагается в [collector](./collector).

## Параметры запуска

При запуске экземпляр хранилища читает переменные окружения:

- **COLLECTOR_DB_URI**. Адрес для подключения к БД.

- **COLLECTOR_SELF_URL**. HTTP адрес, по которому организации могут обращаться к хранилищу. 

- **COLLECTOR_REGISTRY_URL**. HTTP адрес реестра. 

- **COLLECTOR_POSITION_X**. Координата *x*, на которой располагается хранилище.

- **COLLECTOR_POSITION_Y**. Координата *y*, на которой располагается хранилище.

Все параметры являются обязательными для работы.


## Основные эндпоинты

1. Клиентские, т.е. для организаций:

   - **GET** */collector*. Получить информацию о хранилище: типы принимаемых отходов и заполненность соответствующих разделов.

   - **PATCH** */collector*. Сделать запрос на отправку отходов. 
   
     Запрос не может быть обработан частично: если хотя бы для одного запрашиваемого типа отходов нет места или в целом раздела, то запрос отклоняется.

2. Для администрирования:

   - **PUT** */collector*. Установить хранилище в конкретное сотояние: поддерживаемые типы отходов, их заполненность и максимальный запас.

   - **DELETE** */collector*. Сбросить заполненность хранилища. Поддерживаемые типы отходов и их максимальный запах не меняется.

## Детали реализации

Запросы к реестру на регистрацию себя в качестве хранилища и, наоборот, на удаление себя происходит при запуске и при завершении работы сервиса соотетственно.

# Организация

Исходный код располагается в [producer](./producer).

## Параметры запуска

При запуске экземпляр организации читает переменные окружения:

- **PRODUCER_REGISTRY_URL**. HTTP адрес реестра. 

- **PRODUCER_POSITION_X**. Координата *x*, на которой располагается организация.

- **PRODUCER_POSITION_Y**. Координата *y*, на которой располагается организация.

Все параметры являются обязательными для работы.

## Основные эндпоинты

- **POST** */producer/wastes*. Создать заявку на обработку отходов.

- **GET** */producer/order/{id}*. Просмотреть статус заявки. 

  Заявка может быть: в работе, обработана или отклонена.

## Детали реализации

Полученная заявка кладется к очередь. Заявки обрабатываются последовательно.

Процесс обработки заявки состоит из:

1. Получения из реестра списка доступных хранилищ.

2. Сортировки хранилищ по близости к себе.

3. Последовательного опроса хранилищ на возможность принятия отходов.

4. Если одно из хранилищ способно принять отходы, то статус заявки меняется на "Обработана", а сам опрос прекращается.

5. Если ни одно хранилище не способно принять отходы, то статус заявки меняется на "Отклонена".